version: "3.3"
services:
    chrome:
        image: selenium/node-chrome:3.141.59-oxygen
        environment:
            HUB_HOST: 'selenium-hub'
            HUB_PORT: '4444'
        logging:
            driver: none
        links:
            - selenium-hub
        volumes:
            - source: '/dev/shm'
              target: '/dev/shm'
              type: 'bind'
    firefox:
        image: selenium/node-firefox:3.141.59-oxygen
        environment:
            HUB_HOST: 'selenium-hub'
            HUB_PORT: '4444'
        logging:
            driver: none
        links:
            - selenium-hub
        volumes:
            - source: '/dev/shm'
              target: '/dev/shm'
              type: 'bind'
    selenium-hub:
        image: selenium/hub:3.141.59-oxygen
        logging:
            driver: none
        ports:
            - 4444:4444
    database:
        image: postgres:latest
        environment:
            POSTGRES_DB: 'todo'
            POSTGRES_PASSWORD: 'hunter2'
            POSTGRES_USER: 'dbuser'
        logging:
            driver: none
        ports:
            - 2345:5432
    test:
        environment:
            DOCKER: 'true'
            TARGET_ADDRESS: 'http://todo-server:8888'
            DB_ADDRESS: 'postgres://dbuser:hunter2@database:5432/todo?sslmode=disable'
            DB_VENDOR: 'postgres'
        links:
            - selenium-hub
            - todo-server
        build:
            context: '../../../'
            dockerfile: 'environments/testing/dockerfiles/frontend-tests.Dockerfile'
        depends_on:
            - firefox
            - chrome
        volumes:
            - source: '../../../artifacts'
              target: '/artifacts'
              type: 'bind'
    todo-server:
        build:
            context: '../../../'
            dockerfile: 'environments/testing/dockerfiles/frontend-tests-server.Dockerfile'
        environment:
            CONFIGURATION_FILEPATH: '/etc/config.toml'
        ports:
            - 80:8888
        links:
            - database

version: "3.3"
services:
    database:
        image: "mariadb:latest"
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: 'no'
            MYSQL_DATABASE: 'todo'
            MYSQL_PASSWORD: 'hunter2'
            MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
            MYSQL_USER: 'dbuser'
        logging:
            driver: none
        ports:
            - 3306:3306
#    workers:
#        container_name: workers
#        depends_on:
#            - todo-server
#        links:
#            - database
#            - nsqlookupd
#        build:
#            context: '../../../../'
#            dockerfile: 'environments/testing/dockerfiles/workers.Dockerfile'
    todo-server:
        links:
            - database
        environment:
            TODO_SERVICE_LOCAL_SECRET_STORE_KEY: 'SUFNQVdBUkVUSEFUVEhJU1NFQ1JFVElTVU5TRUNVUkU='
            USE_NOOP_LOGGER: 'nope'
        volumes:
            - source: '../../../../environments/testing/config_files/integration-tests-mariadb.config'
              target: '/etc/config.toml'
              type: 'bind'
    test:
        container_name: 'mariadb_integration_tests'
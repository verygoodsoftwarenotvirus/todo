version: '3.3'

services:
  coverage-server:
    build:
      context: .
      dockerfile: dockerfiles/coverage-server.Dockerfile
    ports:
      - '7070:7070'
    volumes:
      - ./artifacts:/home/
    environment:
      DOCKER: 'true'
      RECEIVER: 'http://prober:9090'
      RUNTIME_DURATION: '2m'
    networks:
      main:
        aliases:
          - coverage-server
    # logging:
    #   driver: none

  prober:
    build:
      context: .
      dockerfile: dockerfiles/prober.Dockerfile
    ports:
      - '9090:9090'
    environment:
      TARGET_ADDRESS: 'coverage-server:7070'
      WEBSOCKET_CONNECTIONS: 10
      MIN_WEBSOCKET_LIFETIME: '30s'
      MAX_WEBSOCKET_LIFETIME: '1m'
    networks:
      main:
        aliases:
          - prober
    # logging:
    #   driver: none

networks:
  main:
